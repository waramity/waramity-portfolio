crypto!!!

<p id="clock"></p>

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
  integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
  crossorigin="anonymous"
></script>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">
  // var socket = io();

  const socket = io("/crypto");

  socket.on("connect", () => {
    console.log("Connected to server");
    setInterval(() => {
      // socket.emit('my_event', {data: 'I\'m connected!'});
      // socket.emit("ping");

      // socket.emit("connect");
      socket.emit("my_ping");
      console.log("kuy");
    }, 1000); // Send a ping every second
  });

  // socket.on("my_response", function (msg, cb) {
  //   console.log("sis");
  // });

  // socket.on("pong", () => {
  //   console.log("Received pong from server");
  // });
  // socket.on("ping", (payload) => {
  //   console.log("ping");
  //   console.log(payload);
  // });
</script>

<script type="text/javascript">
  function startClock() {
    const currentDate = new Date();
    const options = {
      timeZone: "Asia/Bangkok",
      hour12: false,
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
    };
    const digitalClock = currentDate.toLocaleTimeString("th-TH", options);

    const clockElement = document.getElementById("clock");
    clockElement.textContent = digitalClock;

    setTimeout(startClock, 1000);
  }

  startClock();
</script>

<script type="text/javascript">
  async function prepareOrderBook() {
    await fetch(
      `https://api.binance.com/api/v3/depth?symbol=${this.ticker}&limit=100`
    )
      .then((response) => response.text())
      .then((data) => {
        let depth = JSON.parse(data);
        this.asks = depth.asks;
        this.bids = depth.bids;

        for (let i = 0; i < this.asks.length; i++) {
          var arr = this.asks.map((x) => {
            return Number(x[1]);
          });
          this.asks[i].push(arr.slice(0, i + 1).reduce((a, b) => a + b));
        }
        for (let i = 0; i < this.bids.length; i++) {
          var arr = this.bids.map((x) => {
            return Number(x[1]);
          });
          this.bids[i].push(arr.slice(0, i + 1).reduce((a, b) => a + b));
        }
      });

    this.maxAsk = Math.max(
      ...this.asks.map((x) => {
        return x[2];
      })
    );

    setTimeout(async () => {
      await prepareOrderBook.call(this);
    }, 500);
  }

  const order_book_context = {
    ticker: "BTCUSDT",
    asks: [],
    bids: [],
    maxAsk: 0,
  };

  prepareOrderBook.call(order_book_context);
</script>

<div id="vm" class="container">
  <p>[[ greeting ]]</p>
  <p>[[ flaskGreeting ]]</p>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
<script type="text/javascript">
  const apiEndpoint = "/en/crypto/";

  const vm = new Vue({
    el: "#vm",
    delimiters: ["[[", "]]"],
    data: {
      greeting: "Hello, Vue!",
      flaskGreeting: "flaskGreeting",
    },
    created: async function () {
      const gResponse = await fetch(apiEndpoint + "greeting");
      const gObject = await gResponse.json();
      this.flaskGreeting = gObject.greeting;
    },
  });
</script>
